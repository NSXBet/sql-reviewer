# PostgreSQL DML Dry-Run Validation Tests
#
# Note: These tests validate the rule's behavior when no database connection is available.
# The DML dry-run rule gracefully skips validation when Driver is nil, returning no advice.
# Tests with actual database connections and EXPLAIN execution are covered in integration tests.
# Test 1: INSERT statement - graceful skip without Driver
- statement: INSERT INTO users (id, name, email) VALUES (1, 'John Doe', 'john@example.com')
  changeType: 2
  want: []
# Test 2: UPDATE statement - graceful skip without Driver
- statement: UPDATE users SET name = 'Jane Doe' WHERE id = 1
  changeType: 2
  want: []
# Test 3: DELETE statement - graceful skip without Driver
- statement: DELETE FROM users WHERE id = 1
  changeType: 2
  want: []
# Test 4: Multiple DML statements - graceful skip without Driver
- statement: |
    INSERT INTO users (id, name) VALUES (1, 'Alice');
    UPDATE users SET name = 'Bob' WHERE id = 1;
    DELETE FROM users WHERE id = 2;
  changeType: 2
  want: []
# Test 5: SET ROLE followed by INSERT - graceful skip without Driver
- statement: |
    SET ROLE 'app_user';
    INSERT INTO users (id, name) VALUES (1, 'Test User');
  changeType: 2
  want: []
# Test 6: Complex INSERT with subquery - graceful skip without Driver
- statement: |
    INSERT INTO orders (id, user_id, amount)
    SELECT id, user_id, amount FROM temp_orders WHERE status = 'pending'
  changeType: 2
  want: []
# Test 7: UPDATE with JOIN - graceful skip without Driver
- statement: |
    UPDATE users u
    SET name = o.customer_name
    FROM orders o
    WHERE u.id = o.user_id
  changeType: 2
  want: []
# Test 8: DELETE with subquery - graceful skip without Driver
- statement: |
    DELETE FROM users
    WHERE id IN (SELECT user_id FROM inactive_accounts)
  changeType: 2
  want: []
# Test 9: INSERT with RETURNING clause - graceful skip without Driver
- statement: |
    INSERT INTO users (id, name, email)
    VALUES (1, 'Test', 'test@example.com')
    RETURNING id, name
  changeType: 2
  want: []
# Test 10: UPDATE with CTE - graceful skip without Driver
- statement: |
    WITH updated AS (
      UPDATE users SET name = 'Updated' WHERE id = 1 RETURNING *
    )
    SELECT * FROM updated
  changeType: 2
  want: []
# Test 11: Multi-table UPDATE - graceful skip without Driver
- statement: |
    UPDATE users u
    SET email = 'new@example.com'
    FROM orders o
    WHERE u.id = o.user_id AND o.status = 'active'
  changeType: 2
  want: []
# Test 12: INSERT with ON CONFLICT - graceful skip without Driver
- statement: |
    INSERT INTO users (id, name, email)
    VALUES (1, 'John', 'john@example.com')
    ON CONFLICT (id) DO UPDATE SET email = EXCLUDED.email
  changeType: 2
  want: []
# Test 13: Nested DML statements - graceful skip without Driver
- statement: |
    INSERT INTO users (id, name)
    SELECT id, name FROM (
      SELECT id, name FROM temp_users WHERE active = true
    ) t
  changeType: 2
  want: []
# Test 14: DELETE with multiple conditions - graceful skip without Driver
- statement: |
    DELETE FROM users
    WHERE created_at < NOW() - INTERVAL '1 year'
    AND last_login_at < NOW() - INTERVAL '6 months'
  changeType: 2
  want: []
# Test 15: Batch INSERT - graceful skip without Driver
- statement: |
    INSERT INTO users (id, name, email) VALUES
    (1, 'User1', 'user1@example.com'),
    (2, 'User2', 'user2@example.com'),
    (3, 'User3', 'user3@example.com')
  changeType: 2
  want: []
# Test 16: Non-DML statement (DDL) - should be ignored
- statement: CREATE TABLE test_table (id INTEGER PRIMARY KEY)
  changeType: 1
  want: []
# Test 17: Non-DML statement (SELECT) - should be ignored
- statement: SELECT * FROM users WHERE id = 1
  changeType: 0
  want: []
# Test 18: Mixed DDL and DML - only DML checked, graceful skip without Driver
- statement: |
    CREATE TABLE temp (id INT);
    INSERT INTO temp (id) VALUES (1);
  changeType: 1
  want: []
